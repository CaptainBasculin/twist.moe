<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
	<link rel="stylesheet" type="text/css" href="css/styles.css"/>
	<title>
		Twist mirror website
	</title>
</head>
<body>
<section class="main">
<header>
	
</header>
<main align="center" id="mainthing">
<div id="container">
<button onclick="toggleSearch()" title="Toggle Search bar kitsu and Twist" id="tsearch">
	<
</button>&nbsp;
<div id="twis">
<form>
<input type="text" name="anisearch" placeholder="SEARCH" autocomplete="off"/><br>
	
</form>&nbsp;
<nav>
	<ul class="suggestions">

	</ul>
</nav>
</div>
<div id="kits">
</form>
<input id="ktype" type="text" name="kitssearch" placeholder="KITSU" autocomplete="off" /><br>
<nav>
	<ul class="suggestions2">

	</ul>
</nav>
</div>
</div>
</main>
<div id="useritems">
	<ul>
		<li>
			Change Name
		</li>
		<li>
			Settings
		</li>
		<li>
			Logout
		</li>
	</ul>
</div>
<footer id='myfoot'>
	<p id="welcome"></p>
	<button id="death" title="Forget ME" onclick="forgetUser()">ðŸ’€
	&times;</button>
</footer>
</section>
<section id="play" draggable="true" style="/*display: none;*/">
	<div id="player">
		<video src="/ug/ug2k17/cse/phani.rithvij/Downloads/Kissanime/hunterxhunter2011/Hunter_x_Hunter_(2011)_(Sub)_Episode_060.mp4" style="width: 340px;height: auto;" id="myvid" controls=""></video>
	</div>
</section>
</body>
<script type="text/javascript" src="twistlinks.json"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js">
	//TO GETJSONS from kitsu.io website which is like Myanimelist with no authenication 
</script>
<script type="text/javascript" src="kitsu.js"></script>
<script type="text/javascript" src="search.js"></script>

<script type="text/javascript">
	//Video scripts 
	//video.js

	/*
	user stores user's name
	and lastplayed anime name
	and lastplayed video src 
	*/

	var user = {
		"lastplayed": "",
		"lastanime": "",
		"name": ""
	};
	var username = '';
	const sect = document.querySelector('#play');
	const foot = document.querySelector('#myfoot');
	const video = document.querySelector('#myvid');

	function recentVid(){
	return  video.src || JSON.parse(localStorage.getItem('user')).lastplayed;
	}
	function toggleVid(){
		if(video.paused){
		video.play();
		}else{
			video.pause();
		}
	}
	function randomVid(){

		return video.src;
		// Return episode 1 of a random anime;
	}
</script>
<script type="text/javascript">
	//Set user and lastplayed manager 
	//user.js
	function setUser(){
	if(localStorage.getItem('user') === null){
	localStorage.setItem('user',JSON.stringify(user));
	}
	
	if(JSON.parse(localStorage.getItem('user')).name == ""){
	username = prompt('What should we call you?');
	user.name = username;
	localStorage.setItem('user',JSON.stringify(user));
	}
		username = JSON.parse(localStorage.getItem('user')).name;
		video.src = recentVid();
		const welcome = document.querySelector('#welcome');
		welcome.innerHTML = 'Welcome ' + username;
		setTimeout(userNav,4000);
		user = JSON.parse(localStorage.getItem('user'));
	}
	function forgetUser(){
		//Dangerous 
		confirm('Click Ok to make us forget you') && localStorage.clear();
	}
	function userNav(){
		const welcome = document.querySelector('#welcome');
		welcome.innerHTML = `
		<button id="usernav" onclick="dispNav()">${username}</button>
		`;
	}
	function dispNav(){
		const div = document.querySelector('#useritems');
		//div.classList.toggle("show");
		if(div.style.visibility == "hidden" ){
		div.style.visibility = "visible";
		}else{
		div.style.visibility = "hidden";
		}
		//console.log('show items');
	}
	function setVideo(){
		if(localStorage.getItem('user') === null){
			video.src = randomVid();
		}
		else{
		var lastplayed = JSON.parse(localStorage.getItem('user')).lastplayed;
			
		if(lastplayed != ""){
		video.src = lastplayed;
		}
		else{
		video.src = randomVid();
		user.lastplayed = video.src;
		localStorage.setItem('user',JSON.stringify(user));
		}
		
		}
	}
</script>

<script type="text/javascript">
	//Event listeners 
	//events.js

	//search Kitsu
	//after user stops typing after 1sec doneTyping executes
	var typingTimer;                //timer identifier
	var doneTypingInterval = 1000;  //time in ms (1 seconds)
	//on keyup, start the countdown
	$('#ktype').keyup(function(){
	    clearTimeout(typingTimer);
	    if ($('#ktype').val()) {
	        typingTimer = setTimeout(doneTyping, doneTypingInterval);
	    }
	});
	//search Kitsu

	//search twist
	seart.addEventListener('change', displayMatches);
	seart.addEventListener('keyup', displayMatches);
	//search twist
	
	
	//search kitsu
	/*
	TODO:
			make a loading thing appear
	*/
	//sears.addEventListener('change', kitsSearch);
	//sears.addEventListener('keyup', kitsSearch);
	//search kitsu
	

	//usersetting
	window.addEventListener('load',setUser,false);
	window.addEventListener('load',setVideo,false);
	//usersetting

	//display footer or video
	/*
	sect.addEventListener('click',()=>{
		foot.style.zIndex = 6;
		sect.style.zIndex = 7;
	});
	foot.addEventListener('click',()=>{
		foot.style.zIndex = 7;
		sect.style.zIndex = 6;
	})
	*/
	//display footer or video

	//video play,pause
	video.addEventListener('play',()=>{
		user.lastplayed = video.src;
		localStorage.setItem('user',JSON.stringify(user));
	},false);//setVideo);

	//video.addEventListener('click',toggleVid,false);
	//video play,pause

</script>




</html>